<ui:composition template="/WEB-INF/template/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="titulo">Edição de campanha</ui:define>
	<ui:define name="conteudo">
		<h:form prependId="false">
			<p:messages id="mensagem">
				<p:autoUpdate />
			</p:messages>

			<h1>Edição de campanha</h1>
			<p:panelGrid id="grid" columns="1" layout="grid">
				<p:tabView prependId="false">
					<p:ajax event="tabChange" update="mensagem"/>
					<p:tab id="dadosGerais" title="Dados gerais">
						<h2>Dados gerais</h2>
						<h:panelGroup id="blocoDadosGerais">
							<p:panelGrid id="gridDadosGerais" columns="1" layout="grid">
								<p:focus context="gridDadosGerais" rendered="#{facesContext.validationFailed}" />
								<p:outputLabel for="nome" value="Nome" />
								<h:inputText id="nome"
									value="#{campanhaControladorEdicao.campanhaDto.nome}"
									required="true">
								</h:inputText>
								<p:message for="nome" />
	
								<p:outputLabel for="descricao" value="Descrição" />
								<h:inputTextarea id="descricao"
									value="#{campanhaControladorEdicao.campanhaDto.descricao}"
									rows="6" cols="33">
								</h:inputTextarea>
	
								<p:outputLabel for="dataInicio" value="Data de início" />
								<p:inputMask id="dataInicio"
									value="#{campanhaControladorEdicao.campanhaDto.dataInicio}"
									mask="99/99/9999" required="true" autoClear="false">
								</p:inputMask>	
								<p:message for="dataInicio" />
	
								<p:outputLabel for="dataTermino" value="Data de término" />
								<p:inputMask id="dataTermino"
									value="#{campanhaControladorEdicao.campanhaDto.dataTermino}"
									mask="99/99/9999">
								</p:inputMask>	
								
								<p:outputLabel for="metaFinanceira" value="Meta financeira" />
								<p:inputNumber id="metaFinanceira"
									value="#{campanhaControladorEdicao.campanhaDto.metaFinanceira}"
									decimalPlaces="2">
								</p:inputNumber>
	
								<p:outputLabel for="metaQuantidadeLigacoes"
									value="Meta de quantidade de ligações" />
								<h:inputText id="metaQuantidadeLigacoes"
									value="#{campanhaControladorEdicao.campanhaDto.metaQuantidadeLigacoes}"
									maxlength="9">
								</h:inputText>
								<p:keyFilter for="metaQuantidadeLigacoes" mask="int" />
							</p:panelGrid>
						</h:panelGroup>
					</p:tab>
					<p:tab id="criterios" title="Critérios">
						<h2>Critérios</h2>
						<p:panelGrid id="gridCriterios" columns="1" layout="grid">
							<p:focus context="gridCriterios"
								rendered="#{facesContext.validationFailed}" />
							<p:outputLabel for="nomeCriterio" value="Nome do critério" />
							<h:inputText id="nomeCriterio"
								value="#{campanhaControladorEdicao.nomeCriterio}"
								required="true">
							</h:inputText>
							<p:message for="nomeCriterio" />
							
							<p:outputLabel for="estado" value="Estado" />
							<h:selectOneMenu id="estado"
								value="#{campanhaControladorEdicao.estadoSelecionado}"
								required="true">
								<f:selectItem itemValue="Selecione uma opção" itemLabel="Selecione uma opção" noSelectionOption="true" />
								<f:selectItems value="#{campanhaControladorEdicao.estadosDto}" />
								<f:ajax listener="#{campanhaControladorEdicao.mudouEstado}"
									render="municipio bairro" />
							</h:selectOneMenu>
							<p:message for="estado" />

							<p:outputLabel for="municipio" value="Município" />
							<h:selectOneMenu id="municipio"
								value="#{campanhaControladorEdicao.municipioSelecionado}"
								required="true">
								<f:selectItem itemValue="Selecione uma opção" itemLabel="Selecione uma opção" noSelectionOption="true" />
								<f:selectItems
									value="#{campanhaControladorEdicao.municipiosDto}" />
								<f:ajax listener="#{campanhaControladorEdicao.mudouMunicipio}"
									render="bairro" />
							</h:selectOneMenu>
							<p:message for="municipio" />

							<p:outputLabel for="bairro" value="Bairro" />
							<h:selectOneMenu id="bairro"
								value="#{campanhaControladorEdicao.bairroSelecionado}"
								required="true">
								<f:selectItem itemValue="Selecione uma opção" itemLabel="Selecione uma opção" noSelectionOption="true" />
								<f:selectItems value="#{campanhaControladorEdicao.bairrosDto}" />
							</h:selectOneMenu>
							<p:message for="bairro" />
							
							<p:outputLabel for="quantidadeADistribuir"
								value="Quantidade a distribuir" />
							<h:inputText id="quantidadeADistribuir"
								value="#{campanhaControladorEdicao.quantidadeADistribuir}"
								maxlength="9" required="true">
							</h:inputText>
							<p:keyFilter for="quantidadeADistribuir" mask="int" />
							<p:message for="quantidadeADistribuir" />
														
							<p:commandButton id="adicionarCriterio"
								value="Adicionar Critério"
								actionListener="#{campanhaControladorEdicao.adicionarCriterio}"
								process="@this gridCriterios"
								update="gridCriterios">
							</p:commandButton>
							<p:defaultCommand target="adicionarCriterio" scope="gridCriterios"/>
							
							<h2>Critérios adicionados</h2>
							<p:dataTable id="tabelaCriterio" var="criterioDto"
								value="#{campanhaControladorEdicao.campanhaDto.criteriosDto}"
								paginatorPosition="bottom" emptyMessage="Nenhum resultado.">
								<p:column headerText="Nome do critério">
									<h:outputText value="#{criterioDto}" />
								</p:column>
								<p:column headerText="Ação">
									<p:commandLink id="remover" value="Remover"
										action="#{campanhaControladorEdicao.removerCriterio}"
										process="@this tabelaCriterio" update="tabelaCriterio">
										<f:setPropertyActionListener value="#{criterioDto}"
											target="#{campanhaControladorEdicao.criterioDtoSelecionado}" />
									</p:commandLink>
								</p:column>
							</p:dataTable>
						</p:panelGrid>
					</p:tab>
					<p:tab id="operadores" title="Operadores">
						<h2>Operadores</h2>
						<p:panelGrid id="gridOperadores" columns="1" layout="grid">
							<p:panelGrid id="gridInclusaoAlteracao" columns="1" layout="grid">
								<p:focus context="gridInclusaoAlteracao" rendered="#{facesContext.validationFailed}" />
								<p:outputLabel for="nomeOperador" value="Operador"
									rendered="#{!campanhaControladorEdicao.modoInclusaoAlocacaoOperador}" />
								<h:outputText id="nomeOperador"
									value="#{campanhaControladorEdicao.alocacaoOperadorDtoSelecionado.contaAcessoDto.nome}"
									rendered="#{!campanhaControladorEdicao.modoInclusaoAlocacaoOperador}" />

								<p:outputLabel for="operador" value="Operador"
									rendered="#{campanhaControladorEdicao.modoInclusaoAlocacaoOperador}" />
								<h:selectOneMenu id="operador"
									value="#{campanhaControladorEdicao.operadorSelecionado}"
									required="true" rendered="#{campanhaControladorEdicao.modoInclusaoAlocacaoOperador}">
									<f:selectItem itemValue="Selecione uma opção"
										itemLabel="Selecione uma opção" noSelectionOption="true" />
									<f:selectItems value="#{campanhaControladorEdicao.operadoresDto}" />
								</h:selectOneMenu>
								<p:message for="operador" />
								
								<p:outputLabel for="metaFinanceiraOperador" value="Meta financeira"/>
								<p:inputNumber id="metaFinanceiraOperador"
									value="#{campanhaControladorEdicao.metaFinanceiraOperador}"
									decimalPlaces="2">
								</p:inputNumber>
	
								<p:outputLabel for="metaQuantidadeLigacoesOperador"
									value="Meta de quantidade de ligações"/>
								<h:inputText id="metaQuantidadeLigacoesOperador"
									value="#{campanhaControladorEdicao.metaQuantidadeLigacoesOperador}"
									maxlength="9">
								</h:inputText>
								<p:keyFilter for="metaQuantidadeLigacoesOperador" mask="int" />
	
								<p:panelGrid columns="2" layout="grid">
									<p:commandButton id="salvarAlocacaoOperador" value="Salvar"
										actionListener="#{campanhaControladorEdicao.adicionarAlocacaoOperador}"
										process="@this gridOperadores" update="gridOperadores">
									</p:commandButton>
									<p:defaultCommand target="salvarAlocacaoOperador" scope="gridOperadores"/>
									<p:commandButton id="cancelarAlocacaoOperador" value="Cancelar"
										actionListener="#{campanhaControladorEdicao.cancelarAlteracaoAlocacaoOperador}"
										process="@this" update="gridOperadores"
										rendered="#{!campanhaControladorEdicao.modoInclusaoAlocacaoOperador}">
									</p:commandButton>
								</p:panelGrid>
							</p:panelGrid>
							
							<h2>Operadores alocados</h2>
							<p:dataTable id="tabelaAlocacoesOperadores" var="alocacaoOperadorDto"
								value="#{campanhaControladorEdicao.campanhaDto.alocacoesOperadoresDto}"
								paginatorPosition="bottom" emptyMessage="Nenhum resultado.">
								<p:column headerText="Nome do operador">
									<h:outputText value="#{alocacaoOperadorDto.contaAcessoDto.nome}" />
								</p:column>
								<p:column headerText="Meta financeira">
									<h:outputText value="#{alocacaoOperadorDto.metaFinanceira}"> 
										<f:convertNumber type="currency"/>
									</h:outputText>
								</p:column>
								<p:column headerText="Meta de quantidade de ligações">
									<h:outputText value="#{alocacaoOperadorDto.metaQuantidadeLigacoes}" />
								</p:column>
								<p:column headerText="Ação">
									<p:commandLink id="alterar" value="Alterar"
										action="#{campanhaControladorEdicao.alterarAlocacaoOperador}"
										process="@this" update="gridOperadores">
										<f:setPropertyActionListener value="#{alocacaoOperadorDto}"
											target="#{campanhaControladorEdicao.alocacaoOperadorDtoSelecionado}" />
									</p:commandLink>
									<p:spacer width="10"/>
									<p:commandLink id="remover" value="Remover"
										action="#{campanhaControladorEdicao.removerAlocacaoOperador}"
										process="@this" update="tabelaAlocacoesOperadores">
										<f:setPropertyActionListener value="#{alocacaoOperadorDto}"
											target="#{campanhaControladorEdicao.alocacaoOperadorDtoSelecionado}" />
									</p:commandLink>
								</p:column>
							</p:dataTable>
						</p:panelGrid>
					</p:tab>
				</p:tabView>
			</p:panelGrid>
			<div class="botao_azul">
				<p:commandButton id="salvar" value="Salvar"
					actionListener="#{campanhaControladorEdicao.salvar}" process="@this gridDadosGerais" update="gridDadosGerais">
				</p:commandButton>
				<p:defaultCommand target="salvar" scope="blocoDadosGerais"/>
			</div>
		</h:form>
	</ui:define>
</ui:composition>